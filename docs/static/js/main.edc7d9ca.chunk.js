(this["webpackJsonphawkthorne-js"]=this["webpackJsonphawkthorne-js"]||[]).push([[0],{35:function(t){t.exports=JSON.parse('["abed-castle-interior","abed-cave","acschool","admin-hallway","baseball","black-caverns-2","black-caverns-3","black-caverns","blacksmith","blacksmith-upstairs","borchert-hallway","castle-hawkthorne-entrance","castle-hawkthorne-room-1","castle-hawkthorne-room-2","castle-hawkthorne-room-3","castle-hawkthorne-room-4","castle-hawkthorne-throne","castle-hawkthorne","class-basement","class-hallway-2","class-hallway","deans-closet2","deans-closet","deans-office-2","deans-office","dorm-lobby","forest-2","forest-hidden","forest","frozencave-2","frozencave-3","frozencave","gay-island-2","gay-island-3","gay-island-4","gay-island","gazette-office-2","gazette-office","greendale-anthropology","greendale-biology","greendale-englishmemorial","greendale-exterior","greendale-fry","greendale-ladders","greendale-quad","hallway","house","lab","mens-bathroom","new-abedtown","parking-lot","potteryclass","rainbow-bar","rave-hallway","seabluff","secretwritersgarden","sophieb","studyroom","sunchamber","tavern","test-level","town","trampoline","treeline","upstairs","valley-2","valley-3","valley-chili-fields-2","valley-chili-fields","valley-goat-cave","valley-goat-farm","valley-hills-2","valley-hills","valley-sandpits-2","valley-sandpits-entrance","valley-sandpits","valley-tacotown","valley","vents-2","vents","village-forest-2","village-forest-3","village-forest-4","village-forest-acornpeak-2","village-forest-acornpeak","village-forest-mines-2","village-forest-mines-3","village-forest-mines-entrance","village-forest-mines-return","village-forest-mines-room","village-forest-mines-storage-room","village-forest-mines","village-forest-stonerspeak-2","village-forest-stonerspeak-return","village-forest-stonerspeak","village-forest","village-treeline","winterwonderland2","winterwonderland","womens-bathroom"]')},40:function(t,e,n){},41:function(t,e,n){},48:function(t,e){},50:function(t,e){},76:function(t,e,n){"use strict";n.r(e);var o=n(9),i=n.n(o),a=n(31),r=n.n(a),s=(n(40),n(1)),c=n(32),l=n(4),h=n(3),p=(n(41),n(33)),d=n.n(p),m=n(2),u=n(20),f=function t(e,n,o,i){var a=this;Object(s.a)(this,t),this.draw=function(t,e,n,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};void 0===i.scale&&(i.scale=1);var r=1,s=0,c=1,l=0,h=n,p=o;if(!0===i.flipHorizontal&&(r=-1,s=a.canvas.width,h=a.canvas.width-n-a.spriteWidth),!0===i.flipVertical&&(c=-1,l=a.canvas.height,p=a.canvas.height-o-a.spriteHeight),i.flipDiagonal)return a.context.save(),a.context.translate(n,o),a.context.rotate(Math.PI/180*270),a.context.drawImage(a.sheet,t*a.spriteWidth,e*a.spriteHeight,a.spriteWidth,a.spriteHeight,-a.spriteWidth,0,a.spriteWidth*i.scale,a.spriteHeight*i.scale),void a.context.restore();i.flipVertical||i.flipHorizontal?(a.context.save(),a.context.translate(s,l),a.context.scale(r,c),a.context.drawImage(a.sheet,t*a.spriteWidth,e*a.spriteHeight,a.spriteWidth,a.spriteHeight,h,p,a.spriteWidth*i.scale,a.spriteHeight*i.scale),a.context.restore()):a.context.drawImage(a.sheet,t*a.spriteWidth,e*a.spriteHeight,a.spriteWidth,a.spriteHeight,n,o,a.spriteWidth*i.scale,a.spriteHeight*i.scale)},this.sheet=new Image,this.sheet.src=n,this.spriteWidth=o,this.spriteHeight=i,this.canvas=e,this.context=e.getContext("2d")},g=function t(e,n,o,i,a){var r=this;Object(s.a)(this,t),this.animate=function(t,e,n,o,i){var a=!1;if(r.animation!==t&&(r.animation=t,a=!0),r.direction!==e&&(r.direction=e,a=!0),a){r.frame=0,r.loop=[];var s=r.characterMap[t],c=[];Array.isArray(s)?(r.repeat=s[0],c=s[1]):(r.repeat=s[e][0],c=s[e][1]),c.forEach((function(t){var e=t.split(","),n=Object(u.a)(e,2),o=n[0],i=n[1];if(-1!==o.search("-"))for(var a=o.split("-"),s=Object(u.a)(a,2),c=s[0],l=s[1],h=c;h<=l;h++)r.loop.push({x:h-1,y:i-1});else r.loop.push({x:o-1,y:i-1})}))}r.draw(n,o,i)},this.draw=function(t,e,n){0!==r.loop.length&&(r.sheet.draw(r.loop[r.frame].x,r.loop[r.frame].y,t,e,n),r.frame++,r.frame===r.loop.length&&(r.frame=0))},this.sheet=new f(e,n,o,i),this.frame=0,this.animation="",this.direction="",this.repeat="",this.loop=[],this.characterMap=a},C=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).sprite=new g(t.canvas,t.url,t.width,t.height,t.characterMap),o.Type="SpriteComponent",o}return n}(m.Component),y=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).sprite=new f(t.canvas,t.url,t.width,t.height),o.Type="StaticSpriteComponent",o}return n}(m.Component),b=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).Type="TilesheetComponent",o}return n}(m.Component),v=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).tilesheet=t.tilesheet,o.width=t.width,o.height=t.height,o.x=t.x,o.y=t.y,o.options=t.options,o.Type="TileComponent",o}return n}(m.Component),w=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).x=t.x,o.y=t.y,o.Type="PositionComponent",o}return n}(m.Component),j=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).points=t.points,o.Type="PolygonComponent",o}return n}(m.Component),O=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).points=t.points,o.Type="PolylineComponent",o}return n}(m.Component),x=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).width=t.width,o.height=t.height,o.color=t.color,o.Type="RectangleComponent",o}return n}(m.Component),k=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),void 0===t&&(t={}),(o=e.call(this,t)).Init=function(){o.Container.Components.TilesheetComponent={},o.Container.Components.TileComponent={},o.Container.Components.PositionComponent={},o.Container.Components.SpriteComponent={},o.Container.Components.StaticSpriteComponent={},o.Container.Components.PolygonComponent={},o.Container.Components.RectangleComponent={}},o.ConfigUpdate=function(t){Object.keys(t).forEach((function(e){o.config[e]=t[e]}))},o.Update=function(){if(void 0!==o.config.board){var t=o.config.board.getContext("2d");t.clearRect(0,0,o.config.board.width,o.config.board.height),void 0!==o.Container.Components.RectangleComponent&&Object.keys(o.Container.Components.RectangleComponent).forEach((function(e){var n=o.Container.Components.RectangleComponent[e],i=o.Container.Components.PositionComponent[e];t.beginPath(),t.fillStyle=n.color,t.rect(i.x,i.y,n.width,n.height),t.fill()})),void 0!==o.Container.Components.TilesheetComponent&&Object.keys(o.Container.Components.TilesheetComponent).forEach((function(t){var e=o.Container.Components.TilesheetComponent[t];void 0===o.tilesheets[e.url]&&(o.tilesheets[e.url]=new f(o.config.board,e.url,e.width,e.height),o.Container.Entity(t).destroy())})),void 0!==o.Container.Components.TileComponent&&Object.keys(o.Container.Components.TileComponent).forEach((function(t){var e=o.Container.Components.TileComponent[t],n=o.Container.Components.PositionComponent[t];o.tilesheets[e.tilesheet].draw(e.x,e.y,n.x*e.width,n.y*e.height,e.options)})),void 0!==o.Container.Components.StaticSpriteComponent&&Object.keys(o.Container.Components.StaticSpriteComponent).forEach((function(t){var e=o.Container.Components.StaticSpriteComponent[t],n=o.Container.Components.PositionComponent[t];e.sprite&&e.sprite.draw(0,0,n.x,n.y,e.options)})),void 0!==o.Container.Components.SpriteComponent&&Object.keys(o.Container.Components.SpriteComponent).forEach((function(t){var e=o.Container.Components.SpriteComponent[t],n=o.Container.Components.PositionComponent[t];e.sprite&&e.sprite.animate(e.animation,e.direction,n.x,n.y,{})})),void 0!==o.Container.Components.PolygonComponent&&Object.keys(o.Container.Components.PolygonComponent).forEach((function(e){var n=o.Container.Components.PolygonComponent[e],i=o.Container.Components.PositionComponent[e];t.strokeStyle="#0f0",t.beginPath(),t.moveTo(i.x,i.y),n.points.forEach((function(e){var n=parseInt(e.x)+parseInt(i.x),o=parseInt(e.y)+parseInt(i.y);t.lineTo(n,o)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()})),void 0!==o.Container.Components.PolylineComponent&&Object.keys(o.Container.Components.PolylineComponent).forEach((function(e){var n=o.Container.Components.PolylineComponent[e],i=o.Container.Components.PositionComponent[e];t.strokeStyle="#f00",t.beginPath(),t.moveTo(i.x,i.y),n.points.forEach((function(e){var n=parseInt(e.x)+parseInt(i.x),o=parseInt(e.y)+parseInt(i.y);t.lineTo(n,o)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()}))}},o.Handle="DrawingSystem",o.tilesheets={},o}return n}(m.System),S=n(34),E=n.n(S),P=n(35),T=n(0),I=new m.Manager,M="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master",H=["abed","britta","chang","duncan","garrett","guzman","leonard","rich","troy","vicedean","annie","buddy","dean","fatneil","gilbert","jeff","pierce","shirley","vaughn","vicki"],z=function(t){Object(l.a)(n,t);var e=Object(h.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).componentDidMount=function(){o.handleResize(),fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/character_map.json").then((function(t){return t.json()})).then((function(t){o.setState({characterMap:t},(function(){o.initializeMap()}))})),H.forEach((function(t){fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/characters/"+t+".json").then((function(t){return t.json()})).then((function(e){var n=Object.assign({},o.state.characters);n[t]=e,o.setState({characters:n})}))}))},o.handleResize=function(){var t=window.innerWidth,e=window.innerHeight;null!==o.state.drawingSystem&&o.state.drawingSystem.ConfigUpdate({height:e,width:t,board:document.getElementById("board")})},o.setBackgroundColor=function(t){var e=o.world.Entity();e.Component(new w({x:0,y:0}));var n=t.width*t.tileWidth,i=t.height*t.tileHeight,a="#"+parseInt(t.properties.red).toString(16)+parseInt(t.properties.green).toString(16)+parseInt(t.properties.blue).toString(16);e.Component(new x({width:n,height:i,color:a}))},o.setMusic=function(t){void 0===t&&(t="level");var e="";e=-1!==t.search("ogg")?M+"/src/"+t:"https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/audio/music/"+t+".ogg",o.setState({music:e},(function(){document.getElementById("rap").play()}))},o.initializeMap=function(){var t=M+"/src/maps/"+o.state.map+".tmx";fetch(t).then((function(t){return t.text()})).then((function(t){E.a.parse(t,"",(function(t,e){void 0!==e.properties.red&&o.setBackgroundColor(e),o.setMusic(e.properties.soundtrack),e.layers.forEach((function(t){switch(t.type){case"tile":o.buildTileLayer(t);break;case"object":o.buildObjectLayer(t);break;default:console.log("initializeMap(): Unknown layer type: "+t.type)}}))}))}))},o.initializePlayer=function(){var t=document.getElementById("board"),e="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/images/characters/"+o.state.playerCharacter+"/"+o.state.playerCostume+".png",n=o.world.Entity("player");n.Component(new w(o.state.levelStart)),n.Component(new C({canvas:t,url:e,width:48,height:48,characterMap:o.state.characterMap,animation:o.state.animation,direction:o.state.direction}))},o.buildObjectLayer=function(t){t.objects.forEach((function(t){o.buildObject(t)}))},o.buildObject=function(t){if("sprite"!==t.type){if("door"===t.type){if("main"!==t.name)return;o.setState({levelStart:{x:t.x-0,y:t.y-0}},(function(){o.initializePlayer()}))}null===t.polygon?null===t.polyline||o.buildPolyline(t):o.buildPolygon(t)}else o.buildSprite(t)},o.buildPolygon=function(t){var e=o.world.Entity();e.Component(new w({x:t.x,y:t.y})),e.Component(new j({points:t.polygon}))},o.buildPolyline=function(t){var e=o.world.Entity();e.Component(new w({x:t.x,y:t.y})),e.Component(new O({points:t.polyline}))},o.buildSprite=function(t){var e=M+"/src/"+t.properties.sheet,n=o.world.Entity();n.Component(new w({x:t.x,y:t.y}));var i={flipHorizontal:"true"===t.properties.flip};n.Component(new y({canvas:document.getElementById("board"),url:e,width:t.properties.width,height:t.properties.height,x:t.x,y:t.y,options:i}))},o.buildTileLayer=function(t){var e=t.map.tileSets[0],n=M+"/src/images/"+e.image.source,i=e.image.width/e.tileWidth,a=o.world.Entity();a.Component(new b({url:n,width:e.tileWidth,height:e.tileHeight}));for(var r=t.map.width,s=t.map.height,c=0,l=0;l<s;l++)for(var h=0;h<r;h++)if(void 0!==t.tiles[c]){var p=t.tiles[c].id;if(-1!==p){var d=p%i,m=(p-d)/i,u={};!0===t.horizontalFlips[c]&&(u.flipHorizontal=!0),!0===t.verticalFlips[c]&&(u.flipVertical=!0),!0===t.diagonalFlips[c]&&(u.flipDiagonal=!0),(a=o.world.Entity()).Component(new w({x:h,y:l})),a.Component(new v({tilesheet:n,width:e.tileWidth,height:e.tileHeight,x:d,y:m,options:u})),c++}else c++}else c++},o.changeAnimation=function(t){o.setState({animation:t.target.value},(function(){o.updateSpriteComponent()}))},o.changeDirection=function(t){o.setState({direction:t.target.value},(function(){o.updateSpriteComponent()}))},o.updateSpriteComponent=function(){Object.keys(o.world.Components.SpriteComponent).forEach((function(t){o.world.Components.SpriteComponent[t].animation=o.state.animation,o.world.Components.SpriteComponent[t].direction=o.state.direction}))},o.destroyMap=function(){Object.keys(o.world.Components.TileComponent).forEach((function(t){o.world.Entity(t).destroy()})),Object.keys(o.world.Components.StaticSpriteComponent).forEach((function(t){o.world.Entity(t).destroy()})),Object.keys(o.world.Components.PolygonComponent).forEach((function(t){o.world.Entity(t).destroy()})),void 0!==o.world.Components.PolylineComponent&&Object.keys(o.world.Components.PolylineComponent).forEach((function(t){o.world.Entity(t).destroy()})),void 0!==o.world.Components.RectangleComponent&&Object.keys(o.world.Components.RectangleComponent).forEach((function(t){o.world.Entity(t).destroy()}))},o.changeMap=function(t){o.destroyMap(),o.setState({map:t.target.value},(function(){o.initializeMap()}))},o.volume=function(t){o.setState({volume:t.target.volume})},o.state={music:"",volume:.25,map:"studyroom",animation:"idle",direction:"right",characterMap:{},characters:{},drawingSystem:new k({width:window.innerWidth,height:window.innerHeight}),levelStart:{x:0,y:0},playerCharacter:"annie",playerCostume:"santa"},o.world=I.Container(),o.world.System(o.state.drawingSystem),o.world.Start(250),o}return Object(c.a)(n,[{key:"render",value:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)("canvas",{id:"board",width:"1280",height:"720"}),Object(T.jsxs)("div",{style:{float:"right"},children:[Object(T.jsx)("label",{htmlFor:"map",children:"Choose map:"}),Object(T.jsx)("br",{}),Object(T.jsx)("select",{id:"map",defaultValue:this.state.map,onChange:this.changeMap,children:P.map((function(t,e){return Object(T.jsx)("option",{children:t},e)}))}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)("label",{htmlFor:"animation",children:"Choose animation:"}),Object(T.jsx)("br",{}),Object(T.jsx)("select",{id:"animation",defaultValue:this.state.animation,onChange:this.changeAnimation,children:Object.keys(this.state.characterMap).map((function(t,e){return Object(T.jsx)("option",{children:t},e)}))}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)("label",{htmlFor:"direction",children:"Choose direction:"}),Object(T.jsx)("br",{}),Object(T.jsxs)("select",{id:"direction",defaultValue:this.state.direction,onChange:this.changeDirection,children:[Object(T.jsx)("option",{value:"left",children:"Left"}),Object(T.jsx)("option",{value:"right",children:"Right"})]}),Object(T.jsx)("br",{}),Object(T.jsx)("br",{}),Object(T.jsx)(d.a,{id:"rap",src:this.state.music,loop:!0,controls:!0,onVolumeChanged:this.volume,volume:this.state.volume})]})]})}}]),n}(o.Component),W=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,77)).then((function(e){var n=e.getCLS,o=e.getFID,i=e.getFCP,a=e.getLCP,r=e.getTTFB;n(t),o(t),i(t),a(t),r(t)}))};r.a.render(Object(T.jsx)(i.a.StrictMode,{children:Object(T.jsx)(z,{})}),document.getElementById("root")),W()}},[[76,1,2]]]);
//# sourceMappingURL=main.edc7d9ca.chunk.js.map