(this["webpackJsonphawkthorne-js"]=this["webpackJsonphawkthorne-js"]||[]).push([[0],{35:function(e){e.exports=JSON.parse('["abed-castle-interior","abed-cave","acschool","admin-hallway","baseball","black-caverns-2","black-caverns-3","black-caverns","blacksmith","blacksmith-upstairs","borchert-hallway","castle-hawkthorne-entrance","castle-hawkthorne-room-1","castle-hawkthorne-room-2","castle-hawkthorne-room-3","castle-hawkthorne-room-4","castle-hawkthorne-throne","castle-hawkthorne","class-basement","class-hallway-2","class-hallway","deans-closet2","deans-closet","deans-office-2","deans-office","dorm-lobby","forest-2","forest-hidden","forest","frozencave-2","frozencave-3","frozencave","gay-island-2","gay-island-3","gay-island-4","gay-island","gazette-office-2","gazette-office","greendale-anthropology","greendale-biology","greendale-englishmemorial","greendale-exterior","greendale-fry","greendale-ladders","greendale-quad","hallway","house","lab","mens-bathroom","new-abedtown","parking-lot","potteryclass","rainbow-bar","rave-hallway","seabluff","secretwritersgarden","sophieb","studyroom","sunchamber","tavern","test-level","town","trampoline","treeline","upstairs","valley-2","valley-3","valley-chili-fields-2","valley-chili-fields","valley-goat-cave","valley-goat-farm","valley-hills-2","valley-hills","valley-sandpits-2","valley-sandpits-entrance","valley-sandpits","valley-tacotown","valley","vents-2","vents","village-forest-2","village-forest-3","village-forest-4","village-forest-acornpeak-2","village-forest-acornpeak","village-forest-mines-2","village-forest-mines-3","village-forest-mines-entrance","village-forest-mines-return","village-forest-mines-room","village-forest-mines-storage-room","village-forest-mines","village-forest-stonerspeak-2","village-forest-stonerspeak-return","village-forest-stonerspeak","village-forest","village-treeline","winterwonderland2","winterwonderland","womens-bathroom"]')},40:function(e,t,n){},41:function(e,t,n){},48:function(e,t){},50:function(e,t){},76:function(e,t,n){"use strict";n.r(t);var o=n(9),i=n.n(o),a=n(32),r=n.n(a),s=(n(40),n(1)),c=n(33),l=n(4),h=n(3),p=(n(41),n(34)),m=n.n(p),d=n(2),f=n(21),u=function e(t,n,o,i){var a=this;Object(s.a)(this,e),this.draw=function(e,t,n,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};void 0===i.scale&&(i.scale=1);var r=1,s=0,c=1,l=0,h=n,p=o;if(!0===i.flipHorizontal&&(r=-1,s=a.canvas.width,h=a.canvas.width-n-a.spriteWidth),!0===i.flipVertical&&(c=-1,l=a.canvas.height,p=a.canvas.height-o-a.spriteHeight),i.flipDiagonal)return a.context.save(),a.context.translate(n,o),a.context.rotate(Math.PI/180*270),a.context.drawImage(a.sheet,e*a.spriteWidth,t*a.spriteHeight,a.spriteWidth,a.spriteHeight,-a.spriteWidth,0,a.spriteWidth*i.scale,a.spriteHeight*i.scale),void a.context.restore();i.flipVertical||i.flipHorizontal?(a.context.save(),a.context.translate(s,l),a.context.scale(r,c),a.context.drawImage(a.sheet,e*a.spriteWidth,t*a.spriteHeight,a.spriteWidth,a.spriteHeight,h,p,a.spriteWidth*i.scale,a.spriteHeight*i.scale),a.context.restore()):a.context.drawImage(a.sheet,e*a.spriteWidth,t*a.spriteHeight,a.spriteWidth,a.spriteHeight,n,o,a.spriteWidth*i.scale,a.spriteHeight*i.scale)},this.sheet=new Image,this.sheet.src=n,this.spriteWidth=o,this.spriteHeight=i,this.canvas=t,this.context=t.getContext("2d")},g=function e(t,n,o,i,a){var r=this;Object(s.a)(this,e),this.animate=function(e,t,n,o,i){var a=!1;if(r.animation!==e&&(r.animation=e,a=!0),r.direction!==t&&(r.direction=t,a=!0),a){r.frame=0,r.loop=[];var s=r.characterMap[e],c=[];Array.isArray(s)?(r.repeat=s[0],c=s[1]):(r.repeat=s[t][0],c=s[t][1]),c.forEach((function(e){var t=e.split(","),n=Object(f.a)(t,2),o=n[0],i=n[1];if(-1!==o.search("-"))for(var a=o.split("-"),s=Object(f.a)(a,2),c=s[0],l=s[1],h=c;h<=l;h++)r.loop.push({x:h-1,y:i-1});else r.loop.push({x:o-1,y:i-1})}))}r.draw(n,o,i)},this.draw=function(e,t,n){0!==r.loop.length&&(r.sheet.draw(r.loop[r.frame].x,r.loop[r.frame].y,e,t,n),r.frame++,r.frame===r.loop.length&&(r.frame=0))},this.sheet=new u(t,n,o,i),this.frame=0,this.animation="",this.direction="",this.repeat="",this.loop=[],this.characterMap=a},y=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).sprite=new g(e.canvas,e.url,e.width,e.height,e.characterMap),o.Type="SpriteComponent",o}return n}(d.Component),C=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).sprite=new u(e.canvas,e.url,e.width,e.height),o.Type="StaticSpriteComponent",o}return n}(d.Component),v=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).Type="TilesheetComponent",o}return n}(d.Component),b=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).tilesheet=e.tilesheet,o.width=e.width,o.height=e.height,o.x=e.x,o.y=e.y,o.options=e.options,o.Type="TileComponent",o}return n}(d.Component),w=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).x=e.x,o.y=e.y,o.Type="PositionComponent",o}return n}(d.Component),j=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).points=e.points,o.Type="PolygonComponent",o}return n}(d.Component),x=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).points=e.points,o.Type="PolylineComponent",o}return n}(d.Component),O=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).width=e.width,o.height=e.height,o.color=e.color,o.Type="RectangleComponent",o}return n}(d.Component),k=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),void 0===e&&(e={}),(o=t.call(this,e)).Init=function(){o.Container.Components.TilesheetComponent={},o.Container.Components.TileComponent={},o.Container.Components.PositionComponent={},o.Container.Components.SpriteComponent={},o.Container.Components.StaticSpriteComponent={},o.Container.Components.PolygonComponent={},o.Container.Components.RectangleComponent={}},o.ConfigUpdate=function(e){Object.keys(e).forEach((function(t){o.config[t]=e[t]})),e.width&&(o.config.board.width=o.config.width),e.height&&(o.config.board.height=o.config.height)},o.ShouldDraw=function(e,t,n,i){var a=o.config.camera.x,r=(o.config.camera.y,parseInt(o.config.camera.x)+parseInt(o.config.board.width)),s=(parseInt(o.config.camera.y),parseInt(o.config.board.height),e),c=parseInt(e)+parseInt(n);parseInt(t),parseInt(i);return!(c<a)&&!(s>r)},o.Update=function(){if(void 0!==o.config.board){var e=o.config.board.getContext("2d");e.clearRect(0,0,o.config.board.width,o.config.board.height),void 0!==o.Container.Components.RectangleComponent&&Object.keys(o.Container.Components.RectangleComponent).forEach((function(t){var n=o.Container.Components.RectangleComponent[t],i=o.Container.Components.PositionComponent[t];e.beginPath(),e.fillStyle=n.color,e.rect(i.x-o.config.camera.x,i.y-o.config.camera.y,n.width,n.height),e.fill()})),void 0!==o.Container.Components.TilesheetComponent&&Object.keys(o.Container.Components.TilesheetComponent).forEach((function(e){var t=o.Container.Components.TilesheetComponent[e];void 0===o.tilesheets[t.url]&&(o.tilesheets[t.url]=new u(o.config.board,t.url,t.width,t.height),o.Container.Entity(e).destroy())})),void 0!==o.Container.Components.TileComponent&&Object.keys(o.Container.Components.TileComponent).forEach((function(e){var t=o.Container.Components.TileComponent[e],n=o.Container.Components.PositionComponent[e],i=o.tilesheets[t.tilesheet];o.ShouldDraw(n.x*t.width,n.y*t.height,t.width,t.height)&&i.draw(t.x,t.y,n.x*t.width-o.config.camera.x,n.y*t.height-o.config.camera.y,t.options)})),void 0!==o.Container.Components.StaticSpriteComponent&&Object.keys(o.Container.Components.StaticSpriteComponent).forEach((function(e){var t=o.Container.Components.StaticSpriteComponent[e],n=o.Container.Components.PositionComponent[e];o.ShouldDraw(n.x,n.y,t.width,t.height)&&t.sprite.draw(0,0,n.x-o.config.camera.x,n.y-o.config.camera.y,t.options)})),void 0!==o.Container.Components.SpriteComponent&&Object.keys(o.Container.Components.SpriteComponent).forEach((function(e){var t=o.Container.Components.SpriteComponent[e],n=o.Container.Components.PositionComponent[e];o.ShouldDraw(n.x,n.y,t.width,t.height)&&t.sprite.animate(t.animation,t.direction,n.x-o.config.camera.x,n.y-o.config.camera.y,{})})),void 0!==o.Container.Components.PolygonComponent&&Object.keys(o.Container.Components.PolygonComponent).forEach((function(t){var n=o.Container.Components.PolygonComponent[t],i=o.Container.Components.PositionComponent[t];e.strokeStyle="#0f0",e.beginPath(),e.moveTo(i.x-o.config.camera.x,i.y-o.config.camera.y),n.points.forEach((function(t){var n=parseInt(t.x)+parseInt(i.x)-o.config.camera.x,a=parseInt(t.y)+parseInt(i.y)-o.config.camera.y;e.lineTo(n,a)})),e.lineTo(i.x-o.config.camera.x,i.y-o.config.camera.y),e.closePath(),e.stroke()})),void 0!==o.Container.Components.PolylineComponent&&Object.keys(o.Container.Components.PolylineComponent).forEach((function(t){var n=o.Container.Components.PolylineComponent[t],i=o.Container.Components.PositionComponent[t];e.strokeStyle="#f00",e.beginPath(),e.moveTo(i.x-o.config.camera.x,i.y-o.config.camera.y),n.points.forEach((function(t){var n=parseInt(t.x)+parseInt(i.x)-o.config.camera.x,a=parseInt(t.y)+parseInt(i.y)-o.config.camera.y;e.lineTo(n,a)})),e.lineTo(i.x-o.config.camera.x,i.y-o.config.camera.y),e.closePath(),e.stroke()}))}},o.Handle="DrawingSystem",o.tilesheets={},o.config.camera={x:0,y:0},o}return n}(d.System),S=n(20),E=n.n(S),P=n(35),I=n(0),T=new d.Manager,M="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master",z=M+"/src/audio/music/",H=["abed","britta","chang","duncan","garrett","guzman","leonard","rich","troy","vicedean","annie","buddy","dean","fatneil","gilbert","jeff","pierce","shirley","vaughn","vicki"],W=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).componentWillUnmount=function(){document.removeEventListener("keydown",o.keyDown)},o.componentDidMount=function(){document.addEventListener("keydown",o.keyDown),o.handleResize(),fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/character_map.json").then((function(e){return e.json()})).then((function(e){o.setState({characterMap:e},(function(){o.initializeMap()}))})),H.forEach((function(e){fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/characters/"+e+".json").then((function(e){return e.json()})).then((function(t){var n=Object.assign({},o.state.characters);n[e]=t,o.setState({characters:n})}))}))},o.handleResize=function(){var e=window.innerWidth,t=window.innerHeight;null!==o.state.drawingSystem&&o.state.drawingSystem.ConfigUpdate({height:t,width:e,board:document.getElementById("board")})},o.setBackgroundColor=function(e){var t=o.world.Entity();t.Component(new w({x:0,y:0}));var n=e.width*e.tileWidth,i=e.height*e.tileHeight,a="#"+parseInt(e.properties.red).toString(16)+parseInt(e.properties.green).toString(16)+parseInt(e.properties.blue).toString(16);t.Component(new O({width:n,height:i,color:a}))},o.setMusic=function(e){void 0===e&&(e="level");var t="";t=-1!==e.search("ogg")?M+"/src/"+e:z+e+".ogg",o.setState({music:t},(function(){document.getElementById("rap").play()}))},o.initializeMap=function(){var e=M+"/src/maps/"+o.state.map+".tmx";fetch(e).then((function(e){return e.text()})).then((function(e){E.a.parse(e,"",(function(e,t){void 0!==t.properties.red&&o.setBackgroundColor(t),o.setMusic(t.properties.soundtrack),t.layers.forEach((function(e){switch(e.type){case"tile":o.buildTileLayer(e);break;case"object":o.buildObjectLayer(e);break;default:console.log("initializeMap(): Unknown layer type: "+e.type)}}))}))}))},o.moveCamera=function(e,t){o.setState({camera:{x:e,y:t}},(function(){o.state.drawingSystem.ConfigUpdate({camera:o.state.camera})}))},o.centerCamera=function(){var e=o.world.Components.PositionComponent.player,t=o.state.drawingSystem.config.width,n=o.state.camera.x+.75*t;if(e.x>n)o.moveCamera(o.state.camera.x+5,o.state.camera.y);else{var i=o.state.camera.x+.25*t;if(e.x<i){var a=o.state.camera.x-5;return a<0&&(a=0),void o.moveCamera(a,o.state.camera.y)}}},o.setBackgroundColor=function(e){var t=o.world.Entity();t.Component(new w({x:0,y:0}));var n=e.width*e.tileWidth,i=e.height*e.tileHeight,a="#"+parseInt(e.properties.red).toString(16)+parseInt(e.properties.green).toString(16)+parseInt(e.properties.blue).toString(16);t.Component(new O({width:n,height:i,color:a}))},o.setMusic=function(e){void 0===e&&(e="level");var t="";t=-1!==e.search("ogg")?M+"/src/"+e:z+e+".ogg",o.setState({music:t},(function(){document.getElementById("rap").play()}))},o.initializeMap=function(){var e=M+"/src/maps/"+o.state.map+".tmx";fetch(e).then((function(e){return e.text()})).then((function(e){E.a.parse(e,"",(function(e,t){void 0!==t.properties.red&&o.setBackgroundColor(t),o.setMusic(t.properties.soundtrack),t.layers.forEach((function(e){switch(e.type){case"tile":o.buildTileLayer(e);break;case"object":o.buildObjectLayer(e);break;default:console.log("initializeMap(): Unknown layer type: "+e.type)}}))}))}))},o.initializePlayer=function(e){var t=document.getElementById("board"),n="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/images/characters/"+o.state.playerCharacter+"/"+o.state.playerCostume+".png",i=o.world.Entity("player");void 0!==e?i.Component(new w(e)):i.Component(new w(o.state.levelStart)),i.Component(new y({canvas:t,url:n,width:48,height:48,characterMap:o.state.characterMap,animation:o.state.animation,direction:o.state.direction}))},o.buildObjectLayer=function(e){e.objects.forEach((function(e){o.buildObject(e)}))},o.buildObject=function(e){if("sprite"!==e.type){if("door"===e.type){if("main"!==e.name)return;o.setState({levelStart:{x:e.x-0,y:e.y-0}},(function(){o.initializePlayer()}))}null===e.polygon?null===e.polyline||o.buildPolyline(e):o.buildPolygon(e)}else o.buildSprite(e)},o.buildPolygon=function(e){var t=o.world.Entity();t.Component(new w({x:e.x,y:e.y})),t.Component(new j({points:e.polygon}))},o.buildPolyline=function(e){var t=o.world.Entity();t.Component(new w({x:e.x,y:e.y})),t.Component(new x({points:e.polyline}))},o.buildSprite=function(e){var t=M+"/src/"+e.properties.sheet,n=o.world.Entity();n.Component(new w({x:e.x,y:e.y}));var i={flipHorizontal:"true"===e.properties.flip};n.Component(new C({canvas:document.getElementById("board"),url:t,width:e.properties.width,height:e.properties.height,x:e.x,y:e.y,options:i}))},o.buildTileLayer=function(e){var t=e.map.tileSets[0],n=M+"/src/images/"+t.image.source,i=t.image.width/t.tileWidth,a=o.world.Entity();a.Component(new v({url:n,width:t.tileWidth,height:t.tileHeight}));for(var r=e.map.width,s=e.map.height,c=0,l=0;l<s;l++)for(var h=0;h<r;h++)if(void 0!==e.tiles[c]){var p=e.tiles[c].id;if(-1!==p){var m=p%i,d=(p-m)/i,f={};!0===e.horizontalFlips[c]&&(f.flipHorizontal=!0),!0===e.verticalFlips[c]&&(f.flipVertical=!0),!0===e.diagonalFlips[c]&&(f.flipDiagonal=!0),(a=o.world.Entity()).Component(new w({x:h,y:l})),a.Component(new b({tilesheet:n,width:t.tileWidth,height:t.tileHeight,x:m,y:d,options:f})),c++}else c++}else c++},o.changeAnimation=function(e){o.setState({animation:e.target.value},(function(){o.updateSpriteComponent()}))},o.changeDirection=function(e){o.setState({direction:e.target.value},(function(){o.updateSpriteComponent()}))},o.updateSpriteComponent=function(){Object.keys(o.world.Components.SpriteComponent).forEach((function(e){o.world.Components.SpriteComponent[e].animation=o.state.animation,o.world.Components.SpriteComponent[e].direction=o.state.direction}))},o.destroyMap=function(){Object.keys(o.world.Components.TileComponent).forEach((function(e){o.world.Entity(e).destroy()})),Object.keys(o.world.Components.StaticSpriteComponent).forEach((function(e){o.world.Entity(e).destroy()})),Object.keys(o.world.Components.PolygonComponent).forEach((function(e){o.world.Entity(e).destroy()})),void 0!==o.world.Components.PolylineComponent&&Object.keys(o.world.Components.PolylineComponent).forEach((function(e){o.world.Entity(e).destroy()})),void 0!==o.world.Components.RectangleComponent&&Object.keys(o.world.Components.RectangleComponent).forEach((function(e){o.world.Entity(e).destroy()}))},o.changeMap=function(e){o.destroyMap(),o.setState({map:e.target.value},(function(){o.initializeMap()}))},o.volume=function(e){o.setState({volume:e.target.volume})},o.keyDown=function(e){var t={x:0,y:0};switch(e.key){case"d":case"D":t.x=5,o.setState({direction:"right"});break;case"a":case"A":t.x=-5,o.setState({direction:"left"})}if(t.x||t.y){var n=o.world.Components.PositionComponent.player;t.x+=n.x,t.y+=n.y,o.initializePlayer(t),o.centerCamera()}},o.state={music:"",volume:.25,map:"studyroom",animation:"idle",direction:"right",characterMap:{},characters:{},drawingSystem:new k({width:window.innerWidth,height:window.innerHeight}),levelStart:{x:0,y:0},playerCharacter:"annie",playerCostume:"santa",camera:{x:0,y:0}},o.world=T.Container(),o.world.System(o.state.drawingSystem),o.world.Start(1e3/15),o}return Object(c.a)(n,[{key:"render",value:function(){return Object(I.jsxs)("div",{children:[Object(I.jsx)("canvas",{id:"board",width:"1280",height:"720"}),Object(I.jsxs)("div",{style:{float:"right"},children:[Object(I.jsx)("label",{htmlFor:"map",children:"Choose map:"}),Object(I.jsx)("br",{}),Object(I.jsx)("select",{id:"map",defaultValue:this.state.map,onChange:this.changeMap,children:P.map((function(e,t){return Object(I.jsx)("option",{children:e},t)}))}),Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)("label",{htmlFor:"animation",children:"Choose animation:"}),Object(I.jsx)("br",{}),Object(I.jsx)("select",{id:"animation",defaultValue:this.state.animation,onChange:this.changeAnimation,children:Object.keys(this.state.characterMap).map((function(e,t){return Object(I.jsx)("option",{children:e},t)}))}),Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)("label",{htmlFor:"direction",children:"Choose direction:"}),Object(I.jsx)("br",{}),Object(I.jsxs)("select",{id:"direction",defaultValue:this.state.direction,onChange:this.changeDirection,children:[Object(I.jsx)("option",{value:"left",children:"Left"}),Object(I.jsx)("option",{value:"right",children:"Right"})]}),Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)(m.a,{id:"rap",src:this.state.music,loop:!0,controls:!0,onVolumeChanged:this.volume,volume:this.state.volume})]})]})}}]),n}(o.Component),D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,77)).then((function(t){var n=t.getCLS,o=t.getFID,i=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),o(e),i(e),a(e),r(e)}))};r.a.render(Object(I.jsx)(i.a.StrictMode,{children:Object(I.jsx)(W,{})}),document.getElementById("root")),D()}},[[76,1,2]]]);
//# sourceMappingURL=main.e193178c.chunk.js.map