(this["webpackJsonphawkthorne-js"]=this["webpackJsonphawkthorne-js"]||[]).push([[0],{17:function(e){e.exports=JSON.parse('["abed-castle-interior","abed-cave","acschool","admin-hallway","baseball","black-caverns-2","black-caverns-3","black-caverns","blacksmith","blacksmith-upstairs","borchert-hallway","castle-hawkthorne-entrance","castle-hawkthorne-room-1","castle-hawkthorne-room-2","castle-hawkthorne-room-3","castle-hawkthorne-room-4","castle-hawkthorne-throne","castle-hawkthorne","class-basement","class-hallway-2","class-hallway","deans-closet2","deans-closet","deans-office-2","deans-office","dorm-lobby","forest-2","forest-hidden","forest","frozencave-2","frozencave-3","frozencave","gay-island-2","gay-island-3","gay-island-4","gay-island","gazette-office-2","gazette-office","greendale-anthropology","greendale-biology","greendale-englishmemorial","greendale-exterior","greendale-fry","greendale-ladders","greendale-quad","hallway","house","lab","mens-bathroom","new-abedtown","parking-lot","potteryclass","rainbow-bar","rave-hallway","seabluff","secretwritersgarden","sophieb","studyroom","sunchamber","tavern","test-level","town","trampoline","treeline","upstairs","valley-2","valley-3","valley-chili-fields-2","valley-chili-fields","valley-goat-cave","valley-goat-farm","valley-hills-2","valley-hills","valley-sandpits-2","valley-sandpits-entrance","valley-sandpits","valley-tacotown","valley","vents-2","vents","village-forest-2","village-forest-3","village-forest-4","village-forest-acornpeak-2","village-forest-acornpeak","village-forest-mines-2","village-forest-mines-3","village-forest-mines-entrance","village-forest-mines-return","village-forest-mines-room","village-forest-mines-storage-room","village-forest-mines","village-forest-stonerspeak-2","village-forest-stonerspeak-return","village-forest-stonerspeak","village-forest","village-treeline","winterwonderland2","winterwonderland","womens-bathroom"]')},22:function(e,t,n){},23:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(6),i=n.n(a),o=n(15),r=n.n(o),s=(n(22),n(0)),c=n(16),l=n(4),h=n(3),d=(n(23),n(2)),p=n(9),f=function e(t,n,a,i){var o=this;Object(s.a)(this,e),this.draw=function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};void 0===i.scale&&(i.scale=1);var r=1,s=0,c=1,l=0,h=n,d=a;if(!0===i.flipHorizontal&&(r=-1,s=o.canvas.width,h=o.canvas.width-n-o.spriteWidth),!0===i.flipVertical&&(c=-1,l=o.canvas.height,d=o.canvas.height-a-o.spriteHeight),i.flipDiagonal)return o.context.save(),o.context.translate(n,a),o.context.rotate(Math.PI/180*270),o.context.drawImage(o.sheet,e*o.spriteWidth,t*o.spriteHeight,o.spriteWidth,o.spriteHeight,-o.spriteWidth,0,o.spriteWidth*i.scale,o.spriteHeight*i.scale),void o.context.restore();i.flipVertical||i.flipHorizontal?(o.context.save(),o.context.translate(s,l),o.context.scale(r,c),o.context.drawImage(o.sheet,e*o.spriteWidth,t*o.spriteHeight,o.spriteWidth,o.spriteHeight,h,d,o.spriteWidth*i.scale,o.spriteHeight*i.scale),o.context.restore()):o.context.drawImage(o.sheet,e*o.spriteWidth,t*o.spriteHeight,o.spriteWidth,o.spriteHeight,n,a,o.spriteWidth*i.scale,o.spriteHeight*i.scale)},this.sheet=new Image,this.sheet.src=n,this.spriteWidth=a,this.spriteHeight=i,this.canvas=t,this.context=t.getContext("2d")},u=function e(t,n,a,i,o){var r=this;Object(s.a)(this,e),this.animate=function(e,t,n,a,i){var o=!1;if(r.animation!==e&&(r.animation=e,o=!0),r.direction!==t&&(r.direction=t,o=!0),o){r.frame=0,r.loop=[];var s=r.characterMap[e],c=[];Array.isArray(s)?(r.repeat=s[0],c=s[1]):(r.repeat=s[t][0],c=s[t][1]),c.forEach((function(e){var t=e.split(","),n=Object(p.a)(t,2),a=n[0],i=n[1];if(-1!==a.search("-"))for(var o=a.split("-"),s=Object(p.a)(o,2),c=s[0],l=s[1],h=c;h<=l;h++)r.loop.push({x:h-1,y:i-1});else r.loop.push({x:a-1,y:i-1})}))}r.draw(n,a,i)},this.draw=function(e,t,n){0!==r.loop.length&&(r.sheet.draw(r.loop[r.frame].x,r.loop[r.frame].y,e,t,n),r.frame++,r.frame===r.loop.length&&(r.frame=0))},this.sheet=new f(t,n,a,i),this.frame=0,this.animation="",this.direction="",this.repeat="",this.loop=[],this.characterMap=o},m=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).sprite=new u(e.canvas,e.url,e.width,e.height,e.characterMap),a.Type="SpriteComponent",a}return n}(d.Component),g=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).Type="TilesheetComponent",a}return n}(d.Component),b=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).tilesheet=e.tilesheet,a.width=e.width,a.height=e.height,a.x=e.x,a.y=e.y,a.options=e.options,a.Type="TileComponent",a}return n}(d.Component),v=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).x=e.x,a.y=e.y,a.Type="PositionComponent",a}return n}(d.Component),w=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),void 0===e&&(e={}),(a=t.call(this,e)).ConfigUpdate=function(e){Object.keys(e).forEach((function(t){a.config[t]=e[t]}))},a.Update=function(){void 0!==a.config.board&&(a.config.board.getContext("2d").clearRect(0,0,a.config.board.width,a.config.board.height),void 0!==a.Container.Components.TilesheetComponent&&Object.keys(a.Container.Components.TilesheetComponent).forEach((function(e){var t=a.Container.Components.TilesheetComponent[e];void 0===a.tilesheets[t.url]&&(a.tilesheets[t.url]=new f(a.config.board,t.url,t.width,t.height))})),void 0!==a.Container.Components.TileComponent&&Object.keys(a.Container.Components.TileComponent).forEach((function(e){var t=a.Container.Components.TileComponent[e],n=a.Container.Components.PositionComponent[e];a.tilesheets[t.tilesheet].draw(t.x,t.y,n.x*t.width,n.y*t.height,t.options)})),void 0!==a.Container.Components.SpriteComponent&&Object.keys(a.Container.Components.SpriteComponent).forEach((function(e){var t=a.Container.Components.SpriteComponent[e],n=a.Container.Components.PositionComponent[e];t.sprite&&t.sprite.animate(t.animation,t.direction,n.x,n.y,{})})))},a.Handle="DrawingSystem",a.tilesheets={},a}return n}(d.System),y=n(24),j=function e(t){Object(s.a)(this,e);for(var n=0;n<t.childNodes.length;n++){var a=t.childNodes[n].nodeName;switch(a){case"property":for(var i=t.childNodes[n].attributes,o=0;o<i.length;o++){var r=i[o].name,c=i[o].textContent;this[r]=c}break;case"#text":break;default:console.log("Unknown node "+a)}}},C=function e(t){Object(s.a)(this,e);for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n].name,i=t.attributes[n].textContent;this[a]=i}for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes[o].nodeName;switch(r){case"properties":this.properties=new j(t.childNodes[o]);break;case"image":this.image=new k(t.childNodes[o]);break;case"#text":break;default:console.log("Tileset: Unknown node "+r)}}},x=function e(t){Object(s.a)(this,e);for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n].name,i=t.attributes[n].textContent;this[a]=i}for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes[o].nodeName;switch(r){case"#text":break;case"data":this.tiles=new O(t.childNodes[o]).tiles;break;default:console.log("Tileset: Unknown node "+r)}}},O=function e(t){Object(s.a)(this,e);for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n].name,i=t.attributes[n].textContent;this[a]=i}var o=atob(t.innerHTML),r=y.inflate(o);this.tiles=[];for(var c=0;c<r.length;c+=4){var l=(r[c+3]<<24)+(r[c+2]<<16)+(r[c+1]<<8)+r[c+0],h={};2147483648&l&&(h.flipHorizontal=!0,l^=2147483648),1073741824&l&&(h.flipVertical=!0,l^=1073741824),536870912&l&&(h.flipDiagonal=!0,l^=536870912),h.id=l-1,this.tiles.push(h)}},k=function e(t){Object(s.a)(this,e);for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n].name,i=t.attributes[n].textContent;this[a]=i}},S=function e(t){var n=this;Object(s.a)(this,e),fetch(t).then((function(e){return e.text()})).then((function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("map")[0],a=0;a<t.attributes.length;a++){var i=t.attributes[a].name,o=t.attributes[a].textContent;"version"!==i&&(n[i]=o)}n.tilesets=[],n.layers=[];for(var r=0;r<t.childNodes.length;r++){var s=t.childNodes[r].nodeName;switch(s){case"properties":n.properties=new j(t.childNodes[r]);break;case"tileset":n.tilesets.push(new C(t.childNodes[r]));break;case"layer":n.layers.push(new x(t.childNodes[r]));break;case"#text":break;default:console.log("Unknown node "+s)}}}))},N=n(17),T=n(1),E=new d.Manager,H="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master",M=["abed","britta","chang","duncan","garrett","guzman","leonard","rich","troy","vicedean","annie","buddy","dean","fatneil","gilbert","jeff","pierce","shirley","vaughn","vicki"],z=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).componentDidMount=function(){a.handleResize(),fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/character_map.json").then((function(e){return e.json()})).then((function(e){a.setState({characterMap:e},(function(){a.initializeMap(),a.initializeCharacters()}))})),M.forEach((function(e){fetch("https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/characters/"+e+".json").then((function(e){return e.json()})).then((function(t){var n=Object.assign({},a.state.characters);n[e]=t,a.setState({characters:n})}))}))},a.handleResize=function(){var e=window.innerWidth,t=window.innerHeight;null!==a.state.drawingSystem&&a.state.drawingSystem.ConfigUpdate({height:t,width:e,board:document.getElementById("board")})},a.initializeMap=function(){var e=new S(H+"/src/maps/"+a.state.map+".tmx");setTimeout((function(){e.layers.forEach((function(t){a.buildLayer(t,e.tilesets[0])}))}),500)},a.initializeCharacters=function(){var e=document.getElementById("board"),t=0,n=400;M.forEach((function(i){var o="https://raw.githubusercontent.com/hawkthorne/hawkthorne-journey/master/src/images/characters/"+i+"/base.png",r=a.world.Entity();r.Component(new v({x:t,y:n})),r.Component(new m({canvas:e,url:o,width:48,height:48,characterMap:a.state.characterMap,animation:a.state.animation,direction:a.state.direction})),(t+=50)>450&&(t=0,n+=50)})),console.log(a.world.Export()),a.world.Start(250)},a.buildLayer=function(e,t){var n=H+"/src/images/"+t.image.source,i=t.tilewidth,o=t.tileheight,r=t.image.width/i,s=a.world.Entity();s.Component(new g({url:n,width:i,height:o}));for(var c=e.width,l=e.height,h=0,d=0;d<l;d++)for(var p=0;p<c;p++){var f=e.tiles[h].id;if(-1!==f){var u=f%r,m=(f-u)/r,w={};!0===e.tiles[h].flipHorizontal&&(w.flipHorizontal=!0),!0===e.tiles[h].flipVertical&&(w.flipVertical=!0),!0===e.tiles[h].flipDiagonal&&(w.flipDiagonal=!0),(s=a.world.Entity()).Component(new v({x:p,y:d})),s.Component(new b({tilesheet:n,width:i,height:o,x:u,y:m,options:w})),h++}else h++}},a.changeAnimation=function(e){a.setState({animation:e.target.value},(function(){a.updateSpriteComponent()}))},a.changeDirection=function(e){a.setState({direction:e.target.value},(function(){a.updateSpriteComponent()}))},a.updateSpriteComponent=function(){Object.keys(a.world.Components.SpriteComponent).forEach((function(e){a.world.Components.SpriteComponent[e].animation=a.state.animation,a.world.Components.SpriteComponent[e].direction=a.state.direction}))},a.destroyTiles=function(){Object.keys(a.world.Components.TileComponent).forEach((function(e){a.world.Entity(e).destroy()})),console.log(a.world.Export())},a.changeMap=function(e){a.destroyTiles(),a.setState({map:e.target.value},(function(){a.initializeMap()}))},a.state={map:"studyroom",animation:"dance",direction:"right",characterMap:{},characters:{},drawingSystem:new w({width:window.innerWidth,height:window.innerHeight})},a.world=E.Container(),a.world.System(a.state.drawingSystem),a}return Object(c.a)(n,[{key:"render",value:function(){return Object(T.jsxs)("div",{className:"App",children:[Object(T.jsx)("canvas",{id:"board",width:"1000",height:"600"}),Object(T.jsxs)("div",{style:{float:"right"},children:[Object(T.jsx)("label",{htmlFor:"map",children:"Choose map:"}),Object(T.jsx)("select",{id:"map",defaultValue:this.state.map,onChange:this.changeMap,children:N.map((function(e,t){return Object(T.jsx)("option",{children:e},t)}))}),Object(T.jsx)("br",{}),Object(T.jsx)("label",{htmlFor:"animation",children:"Choose animation:"}),Object(T.jsx)("select",{id:"animation",defaultValue:this.state.animation,onChange:this.changeAnimation,children:Object.keys(this.state.characterMap).map((function(e,t){return Object(T.jsx)("option",{children:e},t)}))}),Object(T.jsx)("br",{}),Object(T.jsx)("label",{htmlFor:"direction",children:"Choose direction:"}),Object(T.jsxs)("select",{id:"direction",defaultValue:this.state.direction,onChange:this.changeDirection,children:[Object(T.jsx)("option",{value:"left",children:"Left"}),Object(T.jsx)("option",{value:"right",children:"Right"})]})]})]})}}]),n}(a.Component),W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,35)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),o(e),r(e)}))};r.a.render(Object(T.jsx)(i.a.StrictMode,{children:Object(T.jsx)(z,{})}),document.getElementById("root")),W()}},[[34,1,2]]]);
//# sourceMappingURL=main.6fee4e41.chunk.js.map